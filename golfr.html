<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golfr - Golf Betting League 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8faf9;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo {
            font-size: 4em;
            font-weight: 900;
            background: linear-gradient(135deg, #10b981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -2px;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: #6b7280;
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .tournament-selector {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .tournament-selector label {
            font-weight: 600;
            color: #374151;
        }

        .tournament-selector select {
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            min-width: 200px;
        }

        .tournament-selector select:focus {
            outline: none;
            border-color: #10b981;
        }

        .new-tournament-btn {
            padding: 10px 20px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
            margin-left: auto;
        }

        .new-tournament-btn:hover {
            background: #059669;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            background: white;
            padding: 6px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
        }
        
        .tab {
            flex: 1;
            padding: 14px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.2s;
        }
        
        .tab:hover {
            color: #10b981;
        }
        
        .tab.active {
            background: #10b981;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .setup-card {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
        }
        
        .input-group {
            margin-bottom: 24px;
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
            font-size: 15px;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            transition: border-color 0.2s;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #10b981;
        }

        .player-inputs {
            margin-top: 20px;
        }

        .player-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            align-items: center;
        }

        .player-input-row input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
        }

        .player-input-row button {
            padding: 12px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .add-player-btn {
            width: 100%;
            padding: 12px;
            background: #e5e7eb;
            color: #374151;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }

        .add-player-btn:hover {
            background: #d1d5db;
        }
        
        .btn {
            width: 100%;
            padding: 14px 24px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .btn:hover:not(:disabled) {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .draft-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 24px;
        }
        
        .draft-sidebar {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
            position: sticky;
            top: 20px;
            height: fit-content;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .current-picker {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .current-picker h3 {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .current-picker .name {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 6px;
        }
        
        .current-picker .pick-num {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .player-card {
            background: #f9fafb;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
        }
        
        .player-card.active {
            border-color: #10b981;
            background: #ecfdf5;
        }
        
        .player-card .player-name {
            font-weight: 700;
            color: #111827;
            margin-bottom: 10px;
            font-size: 1.05em;
        }
        
        .player-card .picks {
            font-size: 0.9em;
            color: #6b7280;
            line-height: 1.6;
        }
        
        .draft-main {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
        }
        
        .draft-main h3 {
            font-size: 1.6em;
            color: #111827;
            margin-bottom: 20px;
        }
        
        .draft-notice {
            background: #fef3c7;
            color: #92400e;
            padding: 14px 18px;
            border-radius: 10px;
            margin-bottom: 24px;
            font-size: 0.95em;
        }
        
        .golfers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }
        
        .golfer-card {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .golfer-card:hover:not(.picked) {
            transform: translateY(-2px);
            border-color: #10b981;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }
        
        .golfer-card.picked {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f3f4f6;
        }
        
        .golfer-card .rank {
            font-size: 0.75em;
            color: #9ca3af;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .golfer-card .name {
            font-size: 1.05em;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }
        
        .golfer-card .picked-tag {
            background: #10b981;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 600;
            display: inline-block;
            margin-top: 8px;
        }
        
        .leaderboard-table {
            width: 100%;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
        }
        
        .leaderboard-table thead {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .leaderboard-table th {
            padding: 18px 20px;
            text-align: left;
            font-weight: 700;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .leaderboard-table td {
            padding: 16px 20px;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .leaderboard-table tr:last-child td {
            border-bottom: none;
        }
        
        .leaderboard-table tr:hover {
            background: #f9fafb;
        }
        
        .score-negative {
            color: #10b981;
            font-weight: 700;
        }
        
        .score-positive {
            color: #ef4444;
            font-weight: 700;
        }
        
        .score-even {
            color: #6b7280;
            font-weight: 700;
        }

        .scoring-mode-selector {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .scoring-mode-selector h4 {
            color: #166534;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .scoring-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .scoring-mode-option {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .scoring-mode-option:hover {
            border-color: #10b981;
        }

        .scoring-mode-option.selected {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .scoring-mode-option input[type="radio"] {
            margin-right: 8px;
        }

        .scoring-mode-option label {
            cursor: pointer;
            font-weight: 600;
            color: #111827;
        }

        .scoring-mode-option .description {
            font-size: 0.85em;
            color: #6b7280;
            margin-top: 8px;
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }

        .stat-card .label {
            font-size: 0.85em;
            color: #6b7280;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: 700;
            color: #111827;
        }

        .stat-card .value.positive {
            color: #10b981;
        }

        .stat-card .value.negative {
            color: #ef4444;
        }

        .golfer-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .golfer-detail:last-child {
            border-bottom: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
        }

        .modal h3 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #111827;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-buttons .cancel {
            background: #e5e7eb;
            color: #374151;
        }

        .modal-buttons .confirm {
            background: #10b981;
            color: white;
        }

        .tournament-info {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
        }

        .tournament-info h3 {
            color: #111827;
            margin-bottom: 10px;
        }

        .tournament-info p {
            color: #6b7280;
            font-size: 0.95em;
        }

        .refresh-rankings-btn {
            padding: 10px 20px;
            background: #059669;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .refresh-rankings-btn:hover {
            background: #047857;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">golfr</div>
            <div class="tagline">Fantasy Golf Betting League 2026</div>
            <div id="connectionStatus" style="margin-top: 10px; font-size: 0.9em; color: #10b981;">
                üü¢ Multi-device sync enabled
            </div>
        </div>

        <div class="tournament-selector">
            <label>Select PGA Tour Tournament:</label>
            <select id="tournamentSelect" onchange="switchTournament()">
                <option value="">Choose from 2026 schedule...</option>
            </select>
            <div style="margin-left: auto; display: flex; align-items: center; gap: 12px;">
                <span id="rankingsStatus" style="font-size: 0.9em; color: #6b7280;">Rankings loaded</span>
                <button class="refresh-rankings-btn" onclick="viewRankings()" style="background: #6b7280;">
                    üëÅÔ∏è View Rankings
                </button>
                <button class="refresh-rankings-btn" onclick="manualRankingsUpdate()" style="background: #8b5cf6;">
                    ‚úèÔ∏è Update Rankings
                </button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('setup')">Setup</button>
            <button class="tab" onclick="switchTab('draft')">Draft</button>
            <button class="tab" onclick="switchTab('leaderboard')">Leaderboard</button>
            <button class="tab" onclick="switchTab('rules')">Rules</button>
            <button class="tab" onclick="switchTab('history')">History</button>
        </div>

        <div id="setup" class="tab-content active">
            <div class="setup-card">
                <h2 style="margin-bottom: 24px; color: #111827;">Tournament Setup</h2>
                
                <div class="input-group">
                    <label>Tournament Name</label>
                    <input type="text" id="tournamentName" placeholder="e.g., The Masters 2026">
                </div>

                <div class="scoring-mode-selector">
                    <h4>Scoring Mode</h4>
                    <div class="scoring-modes">
                        <div class="scoring-mode-option selected" onclick="selectScoringMode('standard')">
                            <input type="radio" name="scoringMode" value="standard" id="standard" checked>
                            <label for="standard">Standard</label>
                            <span class="description">Sum of all golfer scores</span>
                        </div>
                        <div class="scoring-mode-option" onclick="selectScoringMode('bestBall')">
                            <input type="radio" name="scoringMode" value="bestBall" id="bestBall">
                            <label for="bestBall">Best Ball</label>
                            <span class="description">Only count best 5 scores</span>
                        </div>
                        <div class="scoring-mode-option" onclick="selectScoringMode('matchPlay')">
                            <input type="radio" name="scoringMode" value="matchPlay" id="matchPlay">
                            <label for="matchPlay">Match Play</label>
                            <span class="description">Head-to-head golfer battles</span>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Number of Players (2-8)</label>
                    <input type="number" id="numPlayers" min="2" max="8" value="2" onchange="updatePlayerInputs()">
                </div>

                <div class="player-inputs" id="playerInputs">
                    <div class="player-input-row">
                        <input type="text" placeholder="Player 1 Name" class="player-name-input">
                    </div>
                    <div class="player-input-row">
                        <input type="text" placeholder="Player 2 Name" class="player-name-input">
                    </div>
                </div>

                <button class="btn" onclick="startDraft()">Start Draft</button>
            </div>
        </div>

        <div id="draft" class="tab-content">
            <div id="draftContent"></div>
        </div>

        <div id="leaderboard" class="tab-content">
            <div id="leaderboardContent"></div>
        </div>

        <div id="rules" class="tab-content">
            <div id="rulesContent"></div>
        </div>

        <div id="history" class="tab-content">
            <div id="historyContent"></div>
        </div>
    </div>

    <script>
        // Storage mode: 'shared' for multi-device, 'local' for single device
        const STORAGE_MODE = 'shared';
        const STORAGE_PREFIX = 'golfr_';
        
        // Storage wrapper that uses either shared storage or localStorage
        const storage = {
            async get(key) {
                if (STORAGE_MODE === 'shared' && window.storage) {
                    try {
                        const result = await window.storage.get(STORAGE_PREFIX + key, true);
                        return result ? JSON.parse(result.value) : null;
                    } catch (e) {
                        console.log('Shared storage get failed, using localStorage:', e);
                        const val = localStorage.getItem(STORAGE_PREFIX + key);
                        return val ? JSON.parse(val) : null;
                    }
                }
                const val = localStorage.getItem(STORAGE_PREFIX + key);
                return val ? JSON.parse(val) : null;
            },
            
            async set(key, value) {
                const jsonValue = JSON.stringify(value);
                if (STORAGE_MODE === 'shared' && window.storage) {
                    try {
                        await window.storage.set(STORAGE_PREFIX + key, jsonValue, true);
                        console.log('‚úÖ Saved to shared storage:', key);
                    } catch (e) {
                        console.log('Shared storage set failed, using localStorage:', e);
                        localStorage.setItem(STORAGE_PREFIX + key, jsonValue);
                    }
                } else {
                    localStorage.setItem(STORAGE_PREFIX + key, jsonValue);
                }
            },
            
            async list(prefix = '') {
                if (STORAGE_MODE === 'shared' && window.storage) {
                    try {
                        const result = await window.storage.list(STORAGE_PREFIX + prefix, true);
                        return result ? result.keys : [];
                    } catch (e) {
                        console.log('Shared storage list failed');
                        return [];
                    }
                }
                return [];
            }
        };

        // 2026 PGA Tour Schedule (in chronological order)
        const pgaTourSchedule = [
            { name: "The Sentry", month: "January" },
            { name: "Sony Open in Hawaii", month: "January" },
            { name: "The American Express", month: "January" },
            { name: "Farmers Insurance Open", month: "January" },
            { name: "AT&T Pebble Beach Pro-Am", month: "February" },
            { name: "WM Phoenix Open", month: "February" },
            { name: "The Genesis Invitational", month: "February" },
            { name: "The Honda Classic", month: "February" },
            { name: "Puerto Rico Open", month: "March" },
            { name: "Arnold Palmer Invitational", month: "March" },
            { name: "THE PLAYERS Championship", month: "March" },
            { name: "Valspar Championship", month: "March" },
            { name: "Texas Children's Houston Open", month: "March" },
            { name: "Valero Texas Open", month: "March" },
            { name: "Masters Tournament", month: "April" },
            { name: "RBC Heritage", month: "April" },
            { name: "Zurich Classic of New Orleans", month: "April" },
            { name: "CJ CUP Byron Nelson", month: "May" },
            { name: "Wells Fargo Championship", month: "May" },
            { name: "PGA Championship", month: "May" },
            { name: "Charles Schwab Challenge", month: "May" },
            { name: "the Memorial Tournament", month: "June" },
            { name: "RBC Canadian Open", month: "June" },
            { name: "U.S. Open", month: "June" },
            { name: "Travelers Championship", month: "June" },
            { name: "Rocket Mortgage Classic", month: "July" },
            { name: "John Deere Classic", month: "July" },
            { name: "Genesis Scottish Open", month: "July" },
            { name: "The Open Championship", month: "July" },
            { name: "3M Open", month: "July" },
            { name: "Wyndham Championship", month: "August" },
            { name: "FedEx St. Jude Championship", month: "August" },
            { name: "BMW Championship", month: "August" },
            { name: "TOUR Championship", month: "August" }
        ];

        // World rankings - Top 50 (Current as of February 13, 2026)
        const worldRankings = [
            "Scottie Scheffler",
            "Rory McIlroy",
            "Justin Rose",
            "Tommy Fleetwood",
            "Chris Gotterup",
            "Russell Henley",
            "J.J. Spaun",
            "Robert MacIntyre",
            "Ben Griffin",
            "Xander Schauffele",
            "Hideki Matsuyama",
            "Justin Thomas",
            "Harris English",
            "Sepp Straka",
            "Viktor Hovland",
            "Alex Noren",
            "Patrick Reed",
            "Keegan Bradley",
            "Collin Morikawa",
            "Ludvig Aberg",
            "Cameron Young",
            "Maverick McNealy",
            "Matt Fitzpatrick",
            "Ryan Gerard",
            "Tyrrell Hatton",
            "Si Woo Kim",
            "Aaron Rai",
            "Sam Burns",
            "Shane Lowry",
            "Patrick Cantlay",
            "Marco Penge",
            "Corey Conners",
            "Bryson DeChambeau",
            "Jason Day",
            "Andrew Novak",
            "Matt McCarty",
            "Michael Brennan",
            "Kristoffer Reitan",
            "Samuel Stevens",
            "Rasmus Hojgaard",
            "Michael Kim",
            "Kurt Kitayama",
            "Michael Thorbjornsen",
            "Pierceson Coody",
            "Sami Valimaki",
            "Brian Harman",
            "Max Greyserman",
            "Akshay Bhatia",
            "Ryan Fox",
            "Nicolai Hojgaard"
        ];

        const wildcardField = [
            "Tiger Woods", "Phil Mickelson", "Rickie Fowler", "Brooks Koepka",
            "Dustin Johnson", "Justin Rose", "Sergio Garcia", "Francesco Molinari",
            "Webb Simpson", "Zach Johnson", "Louis Oosthuizen", "Henrik Stenson",
            "Charl Schwartzel", "Martin Kaymer", "Graeme McDowell", "Bubba Watson"
        ];

        let tournaments = {};
        let currentTournamentId = null;
        let draftState = null;
        let tournamentScores = {};
        let liveWorldRankings = [...worldRankings]; // Start with fallback, update with live data
        let pollingInterval = null; // For real-time updates

        // Initialize
        window.onload = function() {
            loadAllTournaments();
            updatePlayerInputs();
            populateTournamentSelect();
            loadTournamentHistory();
            
            // Check for manually saved rankings first
            const manualRankings = localStorage.getItem('golfr_manual_rankings');
            if (manualRankings) {
                try {
                    liveWorldRankings = JSON.parse(manualRankings);
                    updateRankingsStatus(true);
                    console.log('‚úÖ Loaded manually updated rankings');
                } catch (e) {
                    fetchLiveWorldRankings();
                }
            } else {
                fetchLiveWorldRankings();
            }
            
            // Start polling for updates if we have shared storage
            if (STORAGE_MODE === 'shared' && window.storage) {
                startPolling();
                updateConnectionStatus(true);
            } else {
                updateConnectionStatus(false);
            }
        };

        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            if (!statusEl) return;
            
            if (connected && STORAGE_MODE === 'shared') {
                statusEl.innerHTML = 'üü¢ Multi-device sync enabled';
                statusEl.style.color = '#10b981';
            } else {
                statusEl.innerHTML = 'üî¥ Local only (single device)';
                statusEl.style.color = '#f59e0b';
            }
        }

        // Poll for changes from other devices
        function startPolling() {
            if (pollingInterval) clearInterval(pollingInterval);
            
            pollingInterval = setInterval(async () => {
                if (currentTournamentId && draftState && draftState.inProgress) {
                    // Check if tournament data has been updated by another device
                    const updatedTournament = await storage.get('tournament_' + currentTournamentId);
                    
                    if (updatedTournament && updatedTournament.draft) {
                        const serverPickCount = updatedTournament.draft.players.reduce((sum, p) => sum + p.picks.length, 0);
                        const localPickCount = draftState.players.reduce((sum, p) => sum + p.picks.length, 0);
                        
                        // If server has more picks, update our local state
                        if (serverPickCount > localPickCount) {
                            console.log('üîÑ Draft updated by another device');
                            draftState = updatedTournament.draft;
                            tournaments[currentTournamentId] = updatedTournament;
                            
                            if (draftState.complete) {
                                clearInterval(pollingInterval);
                                alert('üéâ Draft completed by another player!');
                                switchTab('leaderboard');
                            } else {
                                renderDraft();
                            }
                        }
                    }
                }
            }, 2000); // Check every 2 seconds
        }

        function stopPolling() {
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
        }

        async function fetchLiveWorldRankings() {
            const statusEl = document.getElementById('rankingsStatus');
            if (statusEl) statusEl.textContent = 'Fetching rankings...';
            
            try {
                // Fetch from GitHub-hosted rankings.json
                // Replace YOUR-USERNAME and YOUR-REPO with actual values
                const response = await fetch('https://raw.githubusercontent.com/YOUR-USERNAME/YOUR-REPO/main/rankings.json');
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.rankings && data.rankings.length >= 30) {
                        liveWorldRankings = data.rankings.slice(0, 50);
                        console.log('‚úÖ Live rankings loaded from GitHub:', liveWorldRankings.length, 'players');
                        updateRankingsStatus(true);
                        
                        if (draftState && draftState.inProgress) {
                            renderDraft();
                        }
                        return;
                    }
                }
            } catch (error) {
                console.log('Could not fetch from GitHub, using fallback:', error.message);
            }
            
            // Use fallback rankings
            liveWorldRankings = [...worldRankings];
            updateRankingsStatus(false);
            
            if (draftState && draftState.inProgress) {
                renderDraft();
            }
        }

        function updateRankingsStatus(success) {
            const statusEl = document.getElementById('rankingsStatus');
            if (!statusEl) return;
            
            if (success) {
                const now = new Date();
                statusEl.textContent = `‚úÖ Live rankings (${now.toLocaleTimeString()})`;
                statusEl.style.color = '#10b981';
                localStorage.setItem('golfr_rankings_updated', Date.now().toString());
            } else {
                statusEl.textContent = '‚ÑπÔ∏è Using fallback rankings';
                statusEl.style.color = '#f59e0b';
            }
        }

        function manualRankingsUpdate() {
            const instructions = `PASTE CURRENT RANKINGS HERE

Go to flashscore.com or ESPN.com and copy the Top 50 golfer names.

Paste them below (one name per line):

Example format:
Scottie Scheffler
Rory McIlroy
Xander Schauffele
...etc

The app will automatically clean up numbers and formatting.`;
            
            const input = prompt(instructions);
            
            if (input && input.trim()) {
                const names = input.trim().split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0)
                    .map(line => {
                        // Clean up common patterns from copy-paste
                        return line
                            .replace(/^\d+\.\s*/, '')  // Remove "1. " at start
                            .replace(/^\d+\s+/, '')     // Remove "1 " at start
                            .replace(/\s+\d+$/, '')     // Remove trailing numbers
                            .replace(/\t/g, ' ')        // Replace tabs with spaces
                            .trim();
                    })
                    .filter(name => name.length > 2 && !name.match(/^\d+$/)); // Only keep valid names, not just numbers
                
                if (names.length >= 30) {
                    liveWorldRankings = names.slice(0, 50);
                    updateRankingsStatus(true);
                    
                    // Save manually updated rankings
                    localStorage.setItem('golfr_manual_rankings', JSON.stringify(liveWorldRankings));
                    
                    alert(`‚úÖ Successfully loaded ${liveWorldRankings.length} golfers!

Top 10:
${liveWorldRankings.slice(0, 10).map((n, i) => `${i+1}. ${n}`).join('\n')}

These rankings are now saved and will be used for all drafts.`);
                    
                    // Re-render if in draft
                    if (draftState && draftState.inProgress) {
                        renderDraft();
                    }
                } else {
                    alert(`‚ö†Ô∏è Only found ${names.length} valid names. 

Please paste at least 30 golfer names, one per line.

Tip: Copy directly from flashscore.com/golf/rankings or ESPN rankings page.`);
                }
            }
        }

        function viewRankings() {
            const rankingsList = liveWorldRankings.slice(0, 50).map((name, i) => `${i+1}. ${name}`).join('\n');
            const message = `Current World Rankings (Top 50):\n\n${rankingsList}\n\n${liveWorldRankings.length} players loaded`;
            alert(message);
        }

        function selectScoringMode(mode) {
            document.querySelectorAll('.scoring-mode-option').forEach(el => el.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            document.getElementById(mode).checked = true;
        }

        function updatePlayerInputs() {
            const num = parseInt(document.getElementById('numPlayers').value);
            const container = document.getElementById('playerInputs');
            container.innerHTML = '';
            
            for (let i = 0; i < num; i++) {
                const row = document.createElement('div');
                row.className = 'player-input-row';
                row.innerHTML = `<input type="text" placeholder="Player ${i + 1} Name" class="player-name-input">`;
                container.appendChild(row);
            }
        }

        function showNewTournamentModal() {
            document.getElementById('newTournamentModal').classList.add('active');
        }

        function closeNewTournamentModal() {
            document.getElementById('newTournamentModal').classList.remove('active');
        }

        function createNewTournament() {
            const name = document.getElementById('newTournamentName').value.trim();
            const date = document.getElementById('newTournamentDate').value;
            
            if (!name) {
                alert('Please enter a tournament name');
                return;
            }

            const id = 'tournament_' + Date.now();
            tournaments[id] = {
                id: id,
                name: name,
                date: date,
                draft: null,
                scores: {},
                completed: false
            };

            saveAllTournaments();
            populateTournamentSelect();
            
            document.getElementById('tournamentSelect').value = id;
            switchTournament();
            closeNewTournamentModal();

            document.getElementById('newTournamentName').value = '';
            document.getElementById('newTournamentDate').value = '';
        }

        function populateTournamentSelect() {
            const select = document.getElementById('tournamentSelect');
            select.innerHTML = '<option value="">Select a tournament...</option>';
            
            // Group tournaments by month
            let currentMonth = '';
            pgaTourSchedule.forEach((t, index) => {
                if (t.month !== currentMonth) {
                    currentMonth = t.month;
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = currentMonth;
                    select.appendChild(optgroup);
                }
                
                const option = document.createElement('option');
                option.value = 'pga_' + index;
                option.textContent = t.name;
                select.lastChild.appendChild(option);
            });
        }

        async function switchTournament() {
            const select = document.getElementById('tournamentSelect');
            const selectedValue = select.value;
            
            if (selectedValue.startsWith('pga_')) {
                const index = parseInt(selectedValue.split('_')[1]);
                const tournamentInfo = pgaTourSchedule[index];
                
                // Check if we have a saved tournament for this event
                currentTournamentId = selectedValue;
                
                // Load from shared storage
                await loadAllTournaments();
                
                if (tournaments[currentTournamentId]) {
                    const tournament = tournaments[currentTournamentId];
                    draftState = tournament.draft;
                    tournamentScores = tournament.scores || {};
                    
                    if (draftState) {
                        if (draftState.complete) {
                            switchTab('leaderboard');
                        } else if (draftState.inProgress) {
                            startPolling(); // Start polling when viewing active draft
                            switchTab('draft');
                        }
                    }
                } else {
                    // New tournament - populate the setup form
                    document.getElementById('tournamentName').value = tournamentInfo.name;
                    draftState = null;
                    tournamentScores = {};
                }
            }
        }

        async function fetchTournamentScores() {
            // Try to fetch real scores from PGA Tour API
            try {
                const response = await fetch('https://site.web.api.espn.com/apis/site/v2/sports/golf/pga/scoreboard');
                const data = await response.json();
                
                if (data.events && data.events.length > 0) {
                    const event = data.events[0];
                    if (event.competitions && event.competitions[0].competitors) {
                        event.competitions[0].competitors.forEach(competitor => {
                            const name = competitor.athlete.displayName;
                            const score = parseInt(competitor.score) || 0;
                            tournamentScores[name] = score;
                        });
                    }
                }
            } catch (error) {
                console.log('Using mock scores');
            }
            
            // Generate mock scores for any golfers not in real data
            [...liveWorldRankings, ...wildcardField].forEach(golfer => {
                if (!tournamentScores[golfer]) {
                    tournamentScores[golfer] = Math.floor(Math.random() * 21) - 10;
                }
            });

            if (currentTournamentId) {
                tournaments[currentTournamentId].scores = tournamentScores;
                saveAllTournaments();
            }
        }

        async function startDraft() {
            const select = document.getElementById('tournamentSelect');
            if (!select.value) {
                alert('Please select a tournament first');
                return;
            }

            const tournamentName = document.getElementById('tournamentName').value.trim();
            const scoringMode = document.querySelector('input[name="scoringMode"]:checked').value;
            const playerInputs = document.querySelectorAll('.player-name-input');
            
            const players = [];
            playerInputs.forEach((input, i) => {
                const name = input.value.trim() || `Player ${i + 1}`;
                players.push({ name: name, picks: [] });
            });

            if (players.length < 2) {
                alert('Need at least 2 players');
                return;
            }
            
            currentTournamentId = select.value;
            
            draftState = {
                players: players,
                currentPicker: 0,
                currentPickNumber: 0,
                inProgress: true,
                complete: false,
                scoringMode: scoringMode
            };

            tournaments[currentTournamentId] = {
                id: currentTournamentId,
                name: tournamentName,
                draft: draftState,
                scores: {},
                completed: false,
                scoringMode: scoringMode
            };

            await saveAllTournaments();
            
            // Start polling for updates from other devices
            if (STORAGE_MODE === 'shared') {
                startPolling();
            }
            
            // Refresh rankings before starting the draft to ensure we have the latest
            await fetchLiveWorldRankings();
            switchTab('draft');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'draft') renderDraft();
            else if (tabName === 'leaderboard') updateLeaderboard();
            else if (tabName === 'rules') loadRules();
            else if (tabName === 'history') loadTournamentHistory();
        }

        function renderDraft() {
            if (!draftState || !draftState.inProgress) {
                document.getElementById('draftContent').innerHTML = '<p style="text-align: center; color: #9ca3af;">No active draft. Start a new tournament from Setup.</p>';
                return;
            }
            
            const content = document.getElementById('draftContent');
            const players = draftState.players;
            const currentPickerIndex = draftState.currentPicker;
            const currentPlayer = players[currentPickerIndex];
            
            // Calculate which pick number we're on (1-7) based on how many picks current player has
            const pickNumber = currentPlayer.picks.length;
            
            // Determine pool based on pick number
            let poolTitle, availableGolfers, poolType;
            
            if (pickNumber < 4) {
                poolTitle = 'üåü Top 30 World Rankings (Pick ' + (pickNumber + 1) + '/4)';
                availableGolfers = liveWorldRankings.slice(0, 30);
                poolType = 'top30';
            } else if (pickNumber < 6) {
                poolTitle = 'üéØ Ranks 30-50 (Pick ' + (pickNumber - 3) + '/2)';
                availableGolfers = liveWorldRankings.slice(30, 50);
                poolType = 'mid';
            } else {
                poolTitle = 'üÉè Wildcard Pick';
                availableGolfers = wildcardField;
                poolType = 'wildcard';
            }
            
            const allPicks = players.flatMap(p => p.picks.map(pick => pick.name));
            
            let html = `<div class="draft-layout">
                <div class="draft-sidebar">
                    <div class="current-picker">
                        <h3>Current Pick</h3>
                        <div class="name">${currentPlayer.name}</div>
                        <div class="pick-num">Pick ${pickNumber + 1} of 7</div>
                    </div>
            `;
            
            players.forEach((player, index) => {
                const isActive = index === currentPickerIndex;
                html += `
                    <div class="player-card ${isActive ? 'active' : ''}">
                        <div class="player-name">${player.name}</div>
                        <div class="picks">
                `;
                
                if (player.picks.length > 0) {
                    player.picks.forEach((pick, i) => {
                        html += `<div>${i + 1}. ${pick.name}</div>`;
                    });
                } else {
                    html += '<div style="color: #9ca3af;">No picks yet</div>';
                }
                
                html += '</div></div>';
            });
            
            html += `</div>
                <div class="draft-main">
                    <h3>${poolTitle}</h3>
                    <div class="draft-notice">
                        üëÜ <strong>${currentPlayer.name}</strong> - Select your golfer
                    </div>
                    <div class="golfers-grid">
            `;
            
            availableGolfers.forEach((golfer, index) => {
                const isPicked = allPicks.includes(golfer);
                const pickedBy = players.find(p => p.picks.some(pick => pick.name === golfer));
                const rank = poolType === 'wildcard' ? '?' : (poolType === 'top30' ? index + 1 : index + 31);
                
                html += `
                    <div class="golfer-card ${isPicked ? 'picked' : ''}" 
                         ${!isPicked ? `onclick="selectGolfer('${golfer.replace(/'/g, "\\'")}', '${poolType}')"` : ''}>
                        <div class="rank">#${rank}</div>
                        <div class="name">${golfer}</div>
                        ${isPicked ? `<div class="picked-tag">‚úì ${pickedBy.name}</div>` : ''}
                    </div>
                `;
            });
            
            html += '</div></div></div>';
            content.innerHTML = html;
        }

        async function selectGolfer(golferName, poolType) {
            const currentPlayer = draftState.players[draftState.currentPicker];
            
            const categoryMap = {
                'top30': 'Top 30',
                'mid': '30-50',
                'wildcard': 'Wildcard'
            };
            
            currentPlayer.picks.push({
                name: golferName,
                category: categoryMap[poolType]
            });
            
            // Move to next player (round robin)
            draftState.currentPicker++;
            
            // If we've gone through all players, go back to first player and increment pick number
            if (draftState.currentPicker >= draftState.players.length) {
                draftState.currentPicker = 0;
                draftState.currentPickNumber++;
            }
            
            // Check if draft is complete (all players have 7 picks)
            const allPlayersDone = draftState.players.every(p => p.picks.length >= 7);
            
            if (allPlayersDone) {
                draftState.inProgress = false;
                draftState.complete = true;
                await saveCurrentTournament();
                stopPolling();
                fetchTournamentScores();
                alert('üéâ Draft Complete!');
                switchTab('leaderboard');
                return;
            }
            
            await saveCurrentTournament();
            renderDraft();
        }

        function updateLeaderboard() {
            const content = document.getElementById('leaderboardContent');
            
            if (!draftState || !draftState.complete) {
                content.innerHTML = '<p style="color: #9ca3af; text-align: center;">Complete draft first</p>';
                return;
            }

            const tournament = tournaments[currentTournamentId];
            const scoringMode = tournament.scoringMode || 'standard';
            
            fetchTournamentScores().then(() => {
                const teamScores = calculateTeamScores(scoringMode);
                teamScores.sort((a, b) => a.score - b.score);
                
                let html = '<div class="tournament-info">';
                html += `<h3>${tournament.name}</h3>`;
                html += `<p>Mode: ${getScoringModeLabel(scoringMode)}</p>`;
                html += '</div>';

                html += '<div class="stats-grid">';
                html += `<div class="stat-card">
                    <div class="label">Leader</div>
                    <div class="value positive">${teamScores[0].name}</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="label">Winning Score</div>
                    <div class="value ${teamScores[0].score < 0 ? 'positive' : 'negative'}">${teamScores[0].score > 0 ? '+' : ''}${teamScores[0].score}</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="label">Total Players</div>
                    <div class="value">${draftState.players.length}</div>
                </div>`;
                html += '</div>';
                
                html += '<table class="leaderboard-table"><thead><tr><th>Pos</th><th>Player</th><th>Score</th><th>Golfers</th></tr></thead><tbody>';
                
                teamScores.forEach((team, index) => {
                    const scoreClass = team.score < 0 ? 'score-negative' : (team.score > 0 ? 'score-positive' : 'score-even');
                    const scoreDisplay = team.score > 0 ? '+' + team.score : team.score;
                    
                    html += `<tr>
                        <td><strong>${index + 1}</strong></td>
                        <td><strong>${team.name}</strong></td>
                        <td class="${scoreClass}">${scoreDisplay}</td>
                        <td>`;
                    
                    team.golferScores.forEach(gs => {
                        const display = gs.score > 0 ? '+' + gs.score : gs.score;
                        html += `<div class="golfer-detail">
                            <span>${gs.name}</span>
                            <span class="${gs.score < 0 ? 'score-negative' : gs.score > 0 ? 'score-positive' : 'score-even'}">${display}</span>
                        </div>`;
                    });
                    
                    html += `</td></tr>`;
                });
                
                html += '</tbody></table>';
                content.innerHTML = html;
            });
        }

        function calculateTeamScores(mode) {
            const teamScores = draftState.players.map(player => {
                const golferScores = player.picks.map(pick => ({
                    name: pick.name,
                    score: tournamentScores[pick.name] || 0
                }));

                let totalScore = 0;

                if (mode === 'standard') {
                    totalScore = golferScores.reduce((sum, gs) => sum + gs.score, 0);
                } else if (mode === 'bestBall') {
                    golferScores.sort((a, b) => a.score - b.score);
                    totalScore = golferScores.slice(0, 5).reduce((sum, gs) => sum + gs.score, 0);
                } else if (mode === 'matchPlay') {
                    // Head to head comparison - simplified
                    totalScore = golferScores.reduce((sum, gs) => sum + gs.score, 0);
                }

                return { 
                    name: player.name, 
                    score: totalScore, 
                    picks: player.picks,
                    golferScores: golferScores 
                };
            });

            return teamScores;
        }

        function getScoringModeLabel(mode) {
            const labels = {
                'standard': 'Standard (Sum All)',
                'bestBall': 'Best Ball (Best 5)',
                'matchPlay': 'Match Play'
            };
            return labels[mode] || 'Standard';
        }

        function loadRules() {
            const content = document.getElementById('rulesContent');
            
            let html = '<div style="max-width: 900px; margin: 0 auto;">';
            html += '<h2 style="margin-bottom: 30px; color: #111827;">Golfr League Rules</h2>';
            
            html += `
                <div style="background: white; border-radius: 16px; padding: 30px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e5e7eb;">
                    <h3 style="color: #10b981; margin-bottom: 20px; font-size: 1.4em;">üìã Draft Format</h3>
                    <div style="color: #374151; line-height: 1.8; font-size: 1.05em;">
                        <p style="margin-bottom: 15px;"><strong>Each player drafts 7 golfers total:</strong></p>
                        <ul style="margin-left: 25px; margin-bottom: 20px;">
                            <li style="margin-bottom: 10px;"><strong>4 picks</strong> from the Top 30 World Rankings</li>
                            <li style="margin-bottom: 10px;"><strong>2 picks</strong> from Ranks 30-50</li>
                            <li style="margin-bottom: 10px;"><strong>1 Wildcard pick</strong> from a special field of veteran players</li>
                        </ul>
                        <p style="margin-bottom: 15px;"><strong>Snake Draft:</strong> Players alternate picks. Once you select a golfer, that golfer is unavailable to other players.</p>
                    </div>
                </div>

                <div style="background: white; border-radius: 16px; padding: 30px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e5e7eb;">
                    <h3 style="color: #10b981; margin-bottom: 20px; font-size: 1.4em;">üåê Multi-Device Drafting</h3>
                    <div style="color: #374151; line-height: 1.8; font-size: 1.05em;">
                        <p style="margin-bottom: 15px;"><strong>Draft with friends from anywhere!</strong></p>
                        <p style="margin-bottom: 15px;">How to set up a remote draft:</p>
                        <ol style="margin-left: 25px; margin-bottom: 20px;">
                            <li style="margin-bottom: 10px;">One person creates the tournament and starts the draft</li>
                            <li style="margin-bottom: 10px;">Other players open Golfr on their device</li>
                            <li style="margin-bottom: 10px;">Everyone selects the same tournament from the dropdown</li>
                            <li style="margin-bottom: 10px;">Click the Draft tab to join the live draft</li>
                            <li style="margin-bottom: 10px;">When it's your turn, the interface will show your name in green</li>
                            <li style="margin-bottom: 10px;">Picks sync automatically across all devices every 2 seconds</li>
                        </ol>
                        <p style="margin-bottom: 15px; padding: 15px; background: #f0fdf4; border-left: 4px solid #10b981; border-radius: 8px;">
                            <strong>üí° Tip:</strong> Keep the Draft tab open during the draft. You'll see picks appear in real-time as other players make their selections!
                        </p>
                        <p style="font-size: 0.95em; color: #6b7280;">Check the status indicator at the top: üü¢ = sync enabled</p>
                    </div>
                </div>

                <div style="background: white; border-radius: 16px; padding: 30px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e5e7eb;">
                    <h3 style="color: #10b981; margin-bottom: 20px; font-size: 1.4em;">üéØ Scoring Modes</h3>
                    <div style="color: #374151; line-height: 1.8; font-size: 1.05em;">
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #111827; margin-bottom: 10px; font-size: 1.15em;">Standard Mode</h4>
                            <p>Your team score is the sum of all 7 golfers' scores. Lower total wins.</p>
                            <p style="margin-top: 8px; font-style: italic; color: #6b7280;">Example: If your golfers shoot -3, -1, +2, E, -4, +1, -2, your total is -7</p>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #111827; margin-bottom: 10px; font-size: 1.15em;">Best Ball Mode</h4>
                            <p>Only your best 5 golfers count toward your score. Your worst 2 scores are dropped.</p>
                            <p style="margin-top: 8px; font-style: italic; color: #6b7280;">Example: Same golfers as above, drop the +2 and +1, your total is -10</p>
                        </div>

                        <div style="margin-bottom: 0px;">
                            <h4 style="color: #111827; margin-bottom: 10px; font-size: 1.15em;">Match Play Mode</h4>
                            <p>Head-to-head scoring where each golfer is matched against opponents' golfers in the same category.</p>
                            <p style="margin-top: 8px; font-style: italic; color: #6b7280;">Currently uses standard scoring - match play mechanics coming soon!</p>
                        </div>
                    </div>
                </div>

                <div style="background: white; border-radius: 16px; padding: 30px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e5e7eb;">
                    <h3 style="color: #10b981; margin-bottom: 20px; font-size: 1.4em;">üèÜ How to Win</h3>
                    <div style="color: #374151; line-height: 1.8; font-size: 1.05em;">
                        <p style="margin-bottom: 15px;">The player with the <strong>lowest total score</strong> wins the tournament (just like real golf!).</p>
                        <p style="margin-bottom: 15px;"><strong>Scoring explained:</strong></p>
                        <ul style="margin-left: 25px; margin-bottom: 20px;">
                            <li style="margin-bottom: 10px;"><strong style="color: #10b981;">Under par (negative)</strong> is good: -5 is better than -2</li>
                            <li style="margin-bottom: 10px;"><strong style="color: #6b7280;">Even par (E or 0)</strong> is neutral</li>
                            <li style="margin-bottom: 10px;"><strong style="color: #ef4444;">Over par (positive)</strong> is bad: +2 is worse than +5</li>
                        </ul>
                    </div>
                </div>

                <div style="background: white; border-radius: 16px; padding: 30px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e5e7eb;">
                    <h3 style="color: #10b981; margin-bottom: 20px; font-size: 1.4em;">üí° Strategy Tips</h3>
                    <div style="color: #374151; line-height: 1.8; font-size: 1.05em;">
                        <ul style="margin-left: 25px;">
                            <li style="margin-bottom: 10px;">Balance consistency with upside - some golfers are steady, others boom or bust</li>
                            <li style="margin-bottom: 10px;">Pay attention to course history - certain players perform better at specific tournaments</li>
                            <li style="margin-bottom: 10px;">In Best Ball mode, taking riskier picks can pay off since bad rounds get dropped</li>
                            <li style="margin-bottom: 10px;">Don't sleep on the wildcard round - veteran players can surprise!</li>
                        </ul>
                    </div>
                </div>
            `;
            
            html += '</div>';
            content.innerHTML = html;
        }

        function loadTournamentHistory() {
            const content = document.getElementById('historyContent');
            const completedTournaments = Object.values(tournaments).filter(t => t.draft && t.draft.complete);
            
            if (completedTournaments.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #9ca3af;">No completed tournaments yet</p>';
                return;
            }

            let html = '<div style="max-width: 1000px; margin: 0 auto;">';
            html += '<h2 style="margin-bottom: 30px; color: #111827;">Tournament History</h2>';
            
            completedTournaments.forEach(tournament => {
                const tempDraft = draftState;
                const tempScores = tournamentScores;
                
                draftState = tournament.draft;
                tournamentScores = tournament.scores;
                
                const teamScores = calculateTeamScores(tournament.scoringMode || 'standard');
                teamScores.sort((a, b) => a.score - b.score);
                const winner = teamScores[0];
                
                draftState = tempDraft;
                tournamentScores = tempScores;
                
                html += `
                    <div class="tournament-info" style="margin-bottom: 20px;">
                        <h3>${tournament.name}</h3>
                        <p>Mode: ${getScoringModeLabel(tournament.scoringMode)} | 
                           Winner: <strong>${winner.name}</strong> (${winner.score > 0 ? '+' : ''}${winner.score})</p>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        async function saveCurrentTournament() {
            if (currentTournamentId && tournaments[currentTournamentId]) {
                tournaments[currentTournamentId].draft = draftState;
                tournaments[currentTournamentId].scores = tournamentScores;
                await saveAllTournaments();
            }
        }

        async function saveAllTournaments() {
            await storage.set('all_tournaments', tournaments);
        }

        async function loadAllTournaments() {
            const saved = await storage.get('all_tournaments');
            if (saved) {
                tournaments = saved;
            }
        }
    </script>
</body>
</html>
